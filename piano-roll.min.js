//! piano-roll.js
//! version : 0.1.0
//! author : Mike Dominice <mike@mikedominice.com>
//! license : MIT
//! github.com/mdomi/piano-roll
/* jshint browser: true */
!function(a,b){"use strict";function c(a,b,d){return"object"==typeof b?Object.keys(b).forEach(function(d){c(a,d,b[d])}):a.setAttribute(b,d),a}function d(a,d){var e=b.createElementNS("http://www.w3.org/2000/svg",a);return d&&c(e,d),e}function e(a){return d("svg",{"class":"piano-roll",width:f(a),height:a.height})}function f(a){return 7*a.octaves*a.keyWidth}function g(a){return"number"==typeof a}function h(a){return"function"==typeof a}function i(a){var b={height:50,keyWidth:12,onmidimessage:function(){},startNote:x,octaves:2,passThrough:!0};return a&&(b.height=a.height||b.height,h(a.onmidimessage)&&(b.onmidimessage=a.onmidimessage),g(a.keyWidth)&&(b.keyWidth=a.keyWidth),g(a.startNote)&&(b.startNote=a.startNote),g(a.octaves)&&(b.octaves=a.octaves)),b}function j(a,b){return a.keys[b-a.options.startNote]}function k(a,b){return o(a.keys,b)}function l(a,b){return k(a,b)+a.options.startNote}function m(a,b){var c=j(a,b[1]);c&&c.classList.add("active")}function n(a,b){var c=j(a,b[1]);c&&c.classList.remove("active")}function o(a,b){return Array.prototype.indexOf.call(a,b)}function p(a,b,c){a.options.onmidimessage({data:new Uint8Array([c,l(a,b),A])})}function q(a,b,c){var d=c.bind(a);a.element.addEventListener(b,d),a._cleanups=(a._cleanups||[]).concat([function(){a.element.removeEventListener(b,d)}])}function r(a,b){return this instanceof r?(this.element=a,this.options=i(b),this.init(),q(this,"mousedown",function(a){a.target.classList.contains("piano-roll-key")&&(a.target.classList.add("active"),p(this,a.target,y))}),void q(this,"mouseup",function(a){a.target.classList.contains("piano-roll-key")&&(a.target.classList.remove("active"),p(this,a.target,z))})):new r(a,b)}function s(a,b){return(240&a[0])===b}function t(a,b,c){var d=u(b),e=C[d]({keyWidth:a.options.keyWidth,height:a.options.height,x:c});return a.keys.push(e),d===v&&a.blackKeys.push(e),d===w&&(a.whiteKeys.push(e),c+=a.options.keyWidth),c}function u(a){return D[a%D.length]}var v="BLACK",w="WHITE",x=48,y=144,z=128,A=127,B=.6,C={WHITE:function(a){return d("rect",{"class":"piano-roll-key piano-roll-white-key",width:a.keyWidth,height:a.height,x:a.x})},BLACK:function(a){var b=B*a.keyWidth;return d("rect",{"class":"piano-roll-key piano-roll-black-key",width:b,height:.5*a.height,x:a.x-b/2})}},D=[w,v,w,v,w,w,v,w,v,w,v,w];r.prototype={init:function(){var a=0;this.svg=e(this.options),this.keys=[],this.blackKeys=[],this.whiteKeys=[];for(var b=this.options.startNote,c=b+12*this.options.octaves,d=b;c>d;d+=1)a=t(this,d,a);this.whiteKeys.forEach(function(a){this.svg.appendChild(a)}.bind(this)),this.blackKeys.forEach(function(a){this.svg.appendChild(a)}.bind(this)),this.element.appendChild(this.svg)},send:function(a,b){s(a,y)&&m(this,a,b),s(a,z)&&n(this,a,b),this.options.passThrough&&this.options.onmidimessage({data:a,timestamp:b})},clear:function(){},destroy:function(){(this._cleanups||[]).forEach(function(a){a()}),this.keys=[],this.blackKeys=[],this.whiteKeys=[],this.element.removeChild(this.svg)}},a.PianoRoll=r}(window,window.document);